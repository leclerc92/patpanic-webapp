# ================================
# Environment Variables Configuration
# ================================
# All variables are validated at startup using Joi schema.
# Application will fail to start if validation fails.

# ================================
# Server Configuration
# ================================
# PORT: Server port number (default: 3000)
# Validation: Must be a valid port number (1-65535)
PORT=3000

# NODE_ENV: Application environment (default: development)
# Validation: Must be one of: development, production, test
NODE_ENV=development

# ================================
# CORS Configuration
# ================================
# ALLOWED_ORIGINS: Comma-separated list of allowed CORS origins
# Validation: REQUIRED in production, optional in development
#
# ⚠️ CRITICAL: In production, this variable is MANDATORY
# The application will NOT START without it in production mode.
#
# Development (optional):
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000
#
# Production (REQUIRED - examples):
# ALLOWED_ORIGINS=https://patpanic.example.com,https://www.patpanic.example.com
# ALLOWED_ORIGINS=https://app.votredomaine.fr
#
# ⚠️ DO NOT use regex patterns in production! Use explicit domains only.

# ================================
# Game Configuration
# ================================
# Already configured in @patpanic/shared package
# ALLOWED_ROOMS=CLEMICHES

# GAME_INACTIVITY_THRESHOLD_MINUTES: Inactivity threshold in minutes before game cleanup
# Validation: Must be between 5 and 1440 minutes (default: 60)
# The cleanup CRON runs every hour to check for inactive games.
#
# Development (default):
GAME_INACTIVITY_THRESHOLD_MINUTES=60
#
# Production (examples):
# GAME_INACTIVITY_THRESHOLD_MINUTES=30  # More aggressive cleanup (30 minutes)
# GAME_INACTIVITY_THRESHOLD_MINUTES=120 # More lenient (2 hours)
#
# ⚠️ Lower values = more frequent cleanup = less memory usage but may disconnect idle players
# ⚠️ Higher values = less frequent cleanup = more memory usage but better UX for idle players

# ================================
# Docker Deployment
# ================================
# ⚠️ MONOREPO NOTE: This backend depends on @patpanic/shared (local package).
# The current Dockerfile is designed for standalone deployment.
#
# For monorepo deployment, you have two options:
# 1. Build from monorepo root and adjust COPY commands to include shared/
# 2. Publish @patpanic/shared to npm registry and use as regular dependency
#
# When deploying with Docker (after resolving monorepo dependencies):
# 1. Mount this file as .env: docker run --env-file .env patpanic-backend
# 2. Pass individual variables: docker run -e PORT=3000 -e NODE_ENV=production
# 3. Use docker-compose with env_file (see docker-compose.yml)
#
# Resource Limits (from docker-compose.yml):
# - Memory: 512M (limit), 256M (reservation)
# - CPU: 1.0 (limit), 0.5 (reservation)
#
# Adjust these in docker-compose.yml based on your traffic expectations:
# - Low traffic (<10 concurrent games): 256M/0.5 CPU sufficient
# - Medium traffic (10-50 games): 512M/1.0 CPU recommended
# - High traffic (>50 games): 1G/2.0 CPU or horizontal scaling

# ================================
# Production Deployment Checklist
# ================================
# Before deploying to production, ensure:
#
# ✅ Environment Variables:
#    - NODE_ENV=production
#    - ALLOWED_ORIGINS set to explicit production domains (no localhost!)
#    - PORT configured (default 3000 is fine)
#    - GAME_INACTIVITY_THRESHOLD_MINUTES set appropriately
#
# ✅ Security Measures (implemented):
#    - CORS centralized and validated
#    - Input validation with bounds checking
#    - UUID validation for player IDs
#    - Score adjustments limited to [-100, +100]
#    - Secure logging (no sensitive data in logs)
#    - Rate limiting on WebSocket events
#    - Graceful shutdown handling (SIGTERM/SIGINT)
#
# ✅ Docker Build:
#    - Multi-stage build optimizes image size
#    - Runs as non-root user (nestjs:nodejs)
#    - Health check configured (30s interval)
#    - Resource limits prevent runaway processes
#
# ✅ Testing:
#    - Run: npm run build (verify TypeScript compilation)
#    - Run: npm run lint (verify code quality)
#    - Run: docker build -t patpanic-backend .
#    - Run: docker-compose up (verify container starts)
#
# ⚠️ NOT INCLUDED (intentionally):
#    - Authentication/Authorization (per user request)
#    - Database persistence (games are in-memory)
#    - Horizontal scaling (single instance only)

# ================================
# Security Notes
# ================================
# This backend implements several security best practices:
#
# 1. CORS Configuration:
#    - Shared between HTTP and WebSocket layers
#    - Validated at startup via ConfigService
#    - Regex patterns for development, explicit domains for production
#
# 2. Input Validation:
#    - All DTOs use class-validator decorators
#    - Player IDs validated as UUIDv4
#    - Score adjustments bounded to prevent game integrity issues
#    - Optional fields properly typed (newName?, newIcon?)
#
# 3. Rate Limiting:
#    - WebSocket events throttled via WsThrottlerGuard
#    - Default: 20 requests per 10 seconds per client
#
# 4. Secure Logging:
#    - No sensitive data logged in production
#    - Event payloads sanitized before logging
#    - Stack traces only in development mode
#
# 5. Graceful Shutdown:
#    - SIGTERM/SIGINT handlers close connections properly
#    - 30-second timeout prevents hung processes
#    - enableShutdownHooks() ensures NestJS lifecycle hooks execute
#
# For more details, see: SECURITY.md